<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>7.4</version>
    <template_groups>
        <template_group>
            <uuid>7df96b18c230490a9a0a9e2307226338</uuid>
            <name>Templates</name>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <uuid>979a8c9d77ea4264979dbff00f779ed7</uuid>
            <template>Local SSL Check</template>
            <name>Local SSL Check</name>
            <groups>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>1ecbb02dde154271b3bc98a7a5cf5a87</uuid>
                    <name>Validation</name>
                    <key>system.run[openssl x509 -noout -checkend 1 -in {$CERT_FILE} | printf &quot;%s&quot; &quot;$?&quot;]</key>
                    <trends>0</trends>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>OpenSSL</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>20c1ced881c24c8e8761e72cb3eada76</uuid>
                            <expression>last(/Local SSL Check/system.run[openssl x509 -noout -checkend 1 -in {$CERT_FILE} | printf &quot;%s&quot; &quot;$?&quot;],#1)&lt;&gt;0</expression>
                            <name>Certificate: SSL certificate is expired</name>
                            <event_name>Certificate: SSL certificate is expired</event_name>
                            <priority>DISASTER</priority>
                            <description>The SSL certificate is expired and needs to be renewed</description>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>6344e0aa6e0e4869b164b66242b9ce81</uuid>
                    <name>End Date</name>
                    <key>system.run[openssl x509 -noout -enddate -in {$CERT_FILE} | cut -d= -f2- | date +%s -f -]</key>
                    <units>unixtime</units>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>OpenSSL</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>ecc0b56926924c6aabb442803d94baf3</uuid>
                            <expression>(last(/Local SSL Check/system.run[openssl x509 -noout -enddate -in {$CERT_FILE} | cut -d= -f2- | date +%s -f -]) - now()) / 86400 &lt; {$CERT.EXPIRY.WARN}</expression>
                            <name>Certificate: SSL certificate expires soon</name>
                            <event_name>Certificate: SSL certificate expires soon (less than {$CERT.EXPIRY.WARN} days)</event_name>
                            <priority>WARNING</priority>
                            <description>The SSL certificate should be updated or it will become untrusted.</description>
                        </trigger>
                        <trigger>
                            <uuid>695d7ac0656f47a183abacc7d539a39e</uuid>
                            <expression>(last(/Local SSL Check/system.run[openssl x509 -noout -enddate -in {$CERT_FILE} | cut -d= -f2- | date +%s -f -]) - now()) / 86400 &lt; {$CERT.EXPIRY.HIGH}</expression>
                            <name>Certificate: SSL certificate expires very soon</name>
                            <event_name>Certificate: SSL certificate expires very soon (less than {$CERT.EXPIRY.WARN} days)</event_name>
                            <priority>AVERAGE</priority>
                            <description>The SSL certificate should be updated or it will become untrusted.</description>
                        </trigger>
                        <trigger>
                            <uuid>9e12ed10481846f29c70f55b7e844bef</uuid>
                            <expression>(last(/Local SSL Check/system.run[openssl x509 -noout -enddate -in {$CERT_FILE} | cut -d= -f2- | date +%s -f -]) - now()) / 86400 &lt; {$CERT.EXPIRY.NOW}</expression>
                            <name>Certificate: SSL certificate will expire</name>
                            <event_name>Certificate: SSL certificate expires soon (less than {$CERT.EXPIRY.NOW} day)</event_name>
                            <priority>HIGH</priority>
                            <description>The SSL certificate should be updated or it will become untrusted.</description>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>3990b3f38e1a4663b98d71208e7f68e5</uuid>
                    <name>Fingerprint</name>
                    <key>system.run[openssl x509 -noout -fingerprint -in {$CERT_FILE} | cut -d= -f2-]</key>
                    <value_type>TEXT</value_type>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>OpenSSL</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>9f723aef376148d69cf5385c033eb3ad</uuid>
                            <expression>last(/Local SSL Check/system.run[openssl x509 -noout -fingerprint -in {$CERT_FILE} | cut -d= -f2-]) &lt;&gt; last(/Local SSL Check/system.run[openssl x509 -noout -fingerprint -in {$CERT_FILE} | cut -d= -f2-],#2)</expression>
                            <name>Certificate: Fingerprint has changed</name>
                            <event_name>Certificate: Fingerprint has changed (new version: {ITEM.VALUE})</event_name>
                            <priority>INFO</priority>
                            <description>The SSL certificate fingerprint has changed. If you did not update the certificate, it may mean your certificate has been hacked. Acknowledge to close the problem manually.
There could be multiple valid certificates on some installations. In this case, the trigger will have a false positive. You can ignore it or disable the trigger.</description>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>2dbd193d2b7a448399617c133d663d5a</uuid>
                    <name>Start Date</name>
                    <key>system.run[openssl x509 -noout -startdate -in {$CERT_FILE} | cut -d= -f2- | date +%s -f -]</key>
                    <units>unixtime</units>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>OpenSSL</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>c2bb256488d14508a504a8439aaba298</uuid>
                    <name>Subject</name>
                    <key>system.run[openssl x509 -noout -subject -in {$CERT_FILE} | cut -d= -f2-]</key>
                    <value_type>TEXT</value_type>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>OpenSSL</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <macros>
                <macro>
                    <macro>{$CERT.EXPIRY.HIGH}</macro>
                    <value>14</value>
                    <description>Number of days until certificate expires</description>
                </macro>
                <macro>
                    <macro>{$CERT.EXPIRY.NOW}</macro>
                    <value>1</value>
                    <description>Number of days until certificate expires</description>
                </macro>
                <macro>
                    <macro>{$CERT.EXPIRY.WARN}</macro>
                    <value>28</value>
                    <description>Number of days until certificate expires</description>
                </macro>
                <macro>
                    <macro>{$CERT_FILE}</macro>
                    <description>Absolute path to the certificate file</description>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
