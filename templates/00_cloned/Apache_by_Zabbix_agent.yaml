zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: f10fc491a20f4d0983147fe4c6d7c361
      name: Templates
  templates:
    - uuid: 0c21d16107a54253ba2908dcee200fc0
      template: 'Apache by Zabbix agent'
      name: 'Apache by Zabbix agent'
      description: |
        Get metrics from mod_status module using HTTP agent.
        https://httpd.apache.org/docs/current/mod/mod_status.html
        
        You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384764-discussion-thread-for-official-zabbix-template-apache
        
        Generated by official Zabbix template tool "Templator"
      readme: |
        ## Overview
        
        This template is designed for the effortless deployment of Apache monitoring by Zabbix via Zabbix agent and doesn't require any external scripts.
        The template `Apache by Zabbix agent` - collects metrics by polling [mod_status](https://httpd.apache.org/docs/current/mod/mod_status.html) locally with Zabbix agent:
          
        ```text
        127.0.0.1
        ServerVersion: Apache/2.4.41 (Unix)
        ServerMPM: event
        Server Built: Aug 14 2019 00:35:10
        CurrentTime: Friday, 16-Aug-2019 12:38:40 UTC
        RestartTime: Wednesday, 14-Aug-2019 07:58:26 UTC
        ParentServerConfigGeneration: 1
        ParentServerMPMGeneration: 0
        ServerUptimeSeconds: 189613
        ServerUptime: 2 days 4 hours 40 minutes 13 seconds
        Load1: 4.60
        Load5: 1.20
        Load15: 0.47
        Total Accesses: 27860
        Total kBytes: 33011
        Total Duration: 54118
        CPUUser: 18.02
        CPUSystem: 31.76
        CPUChildrenUser: 0
        CPUChildrenSystem: 0
        CPULoad: .0262535
        Uptime: 189613
        ReqPerSec: .146931
        BytesPerSec: 178.275
        BytesPerReq: 1213.33
        DurationPerReq: 1.9425
        BusyWorkers: 7
        IdleWorkers: 93
        Processes: 4
        Stopping: 0
        BusyWorkers: 7
        IdleWorkers: 93
        ConnsTotal: 13
        ConnsAsyncWriting: 0
        ConnsAsyncKeepAlive: 5
        ConnsAsyncClosing: 0
        Scoreboard: ...
        
        ```
          
        It also uses Zabbix agent to collect `Apache` Linux process statistics such as CPU usage, memory usage, and whether the process is running or not.
        
        ## Setup
        
        See the setup instructions for [mod_status](https://httpd.apache.org/docs/current/mod/mod_status.html).
        
        Check the availability of the module with this command line: `httpd -M 2>/dev/null | grep status_module`
        
        This is an example configuration of the Apache web server:
        
        ```text
        <Location "/server-status">
          SetHandler server-status
          Require host example.com
        </Location>
        ```
        
        If you use another path, then do not forget to change the `Apache status page path` host wizard configuration field.
        
      groups:
        - name: Templates
      items:
        - uuid: dfd170088ebc4134a835d861a17ad0c5
          name: 'Total bytes'
          type: DEPENDENT
          key: apache.bytes
          value_type: FLOAT
          units: B
          description: 'The total bytes served.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$["Total kBytes"]'
            - type: MULTIPLIER
              parameters:
                - '1024'
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: network
        - uuid: c115d5fe3a5f4702994140b2d97a469f
          name: 'Bytes per second'
          type: DEPENDENT
          key: apache.bytes.rate
          value_type: FLOAT
          units: Bps
          description: |
            It is calculated as a rate of change for total bytes statistics.
            `BytesPerSec` is not used, as it counts the average since the last Apache server start.
            
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$["Total kBytes"]'
            - type: MULTIPLIER
              parameters:
                - '1024'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: network
        - uuid: 3d72fd99fa954d8f9e96b13d19127a78
          name: 'Total requests'
          type: DEPENDENT
          key: apache.requests
          description: 'The total number of the Apache server accesses.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$["Total Accesses"]'
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: network
        - uuid: 364247f6a0094d38a6243f5f6ffe7d85
          name: 'Requests per second'
          type: DEPENDENT
          key: apache.requests.rate
          value_type: FLOAT
          description: |
            It is calculated as a rate of change for the "Total requests" statistics.
            `ReqPerSec` is not used, as it counts the average since the last Apache server start.
            
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$["Total Accesses"]'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: network
        - uuid: 416e0fa51a5b4e748a2b0b0908ba9fd4
          name: Uptime
          type: DEPENDENT
          key: apache.uptime
          units: uptime
          description: 'The service uptime expressed in seconds.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.ServerUptimeSeconds
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: e2418f7c5da8446cb06fd3141fe84c6a
              expression: 'last(/Apache by Zabbix agent/apache.uptime)<10m'
              name: 'Apache: Service has been restarted'
              event_name: 'Apache: Service has been restarted (uptime < 10m)'
              priority: INFO
              description: 'Uptime is less than 10 minutes.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
        - uuid: 4ff3d93aaa8448b48968cd421cf7b220
          name: Version
          type: DEPENDENT
          key: apache.version
          value_type: CHAR
          description: 'The Apache service version.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.ServerVersion
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: df06fb8fac0a4f1691acc22eca8bf8e0
              expression: 'last(/Apache by Zabbix agent/apache.version,#1)<>last(/Apache by Zabbix agent/apache.version,#2) and length(last(/Apache by Zabbix agent/apache.version))>0'
              name: 'Apache: Version has changed'
              event_name: 'Apache: Version has changed (new version: {ITEM.VALUE})'
              priority: INFO
              description: 'Apache version has changed. Acknowledge to close the problem manually.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
        - uuid: 7e10c259b28c4168849a82f83590466e
          name: 'Workers idle cleanup'
          type: DEPENDENT
          key: apache.workers.cleanup
          description: 'The number of workers in cleanup state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.cleanup
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: c17f57941c9c4b1dbbefa5c71d8218d0
          name: 'Workers closing connection'
          type: DEPENDENT
          key: apache.workers.closing
          description: 'The number of workers in closing state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.closing
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: eba5ea4e772a417c8bb13dfe57e808b1
          name: 'Workers DNS lookup'
          type: DEPENDENT
          key: apache.workers.dnslookup
          description: 'The number of workers in `dnslookup` state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.dnslookup
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 98feababd1e446268a8b99e8347c35ac
          name: 'Workers finishing'
          type: DEPENDENT
          key: apache.workers.finishing
          description: 'The number of workers in finishing state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.finishing
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: d77057d0fc96433ab7ac29068f049e42
          name: 'Workers keepalive (read)'
          type: DEPENDENT
          key: apache.workers.keepalive
          description: 'The number of workers in `keepalive` state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.keepalive
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: c590bdaa17b4496a90b69cf46b7f78e7
          name: 'Workers logging'
          type: DEPENDENT
          key: apache.workers.logging
          description: 'The number of workers in logging state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.logging
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 75028871dc364449b43bbf1067e3375c
          name: 'Workers reading request'
          type: DEPENDENT
          key: apache.workers.reading
          description: 'The number of workers in reading state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.reading
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: ea1419d2db0d413883abd3e4c87be4cd
          name: 'Workers sending reply'
          type: DEPENDENT
          key: apache.workers.sending
          description: 'The number of workers in sending state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.sending
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 251127d298064167a5962924a30e6813
          name: 'Workers slot with no current process'
          type: DEPENDENT
          key: apache.workers.slot
          description: 'The number of slots with no current process.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.slot
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 1b94896b3aa8484fb413c51c9d9fd846
          name: 'Workers starting up'
          type: DEPENDENT
          key: apache.workers.starting
          description: 'The number of workers in starting state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.starting
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 1e25a39f0f734041b03bcb44486e5507
          name: 'Workers waiting for connection'
          type: DEPENDENT
          key: apache.workers.waiting
          description: 'The number of workers in waiting state.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.Workers.waiting
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 64c5da59accf4648ae216195af921781
          name: 'Total workers busy'
          type: DEPENDENT
          key: apache.workers_total.busy
          description: 'The total number of busy worker threads/processes.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.BusyWorkers
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 1c92a25134864c61abec01426bc87504
          name: 'Total workers idle'
          type: DEPENDENT
          key: apache.workers_total.idle
          description: 'The total number of idle worker threads/processes.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.IdleWorkers
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          tags:
            - tag: component
              value: system
        - uuid: 86a63f9ca5ba4d33984902d823585712
          name: 'Service response time'
          key: 'net.tcp.service.perf[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"]'
          value_type: FLOAT
          units: s
          tags:
            - tag: component
              value: application
            - tag: component
              value: health
        - uuid: 7c35630037c0478894dd04bd268d2b8c
          name: 'Service ping'
          key: 'net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"]'
          valuemap:
            name: 'Service state'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: application
            - tag: component
              value: health
        - uuid: cde2ccc7fdfe4e65b0570dd7db958e91
          name: 'Get processes summary'
          key: 'proc.get[{$APACHE.PROCESS.NAME.PARAMETER},,,summary]'
          history: '0'
          value_type: TEXT
          description: 'The aggregated data of summary metrics for all processes.'
          tags:
            - tag: component
              value: raw
        - uuid: 0f8213c33bbd4256a5e6df02fa462012
          name: 'Get status'
          key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          history: 1h
          value_type: TEXT
          description: |
            Getting data from a machine-readable version of the Apache status page.
            For more information see Apache Module [mod_status](https://httpd.apache.org/docs/current/mod/mod_status.html).
            
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  var lines = value.split('\n');
                  var output = {},
                  	workers = {
                  		'_': 0, 'S': 0, 'R': 0, 'W': 0,
                  		'K': 0, 'D': 0, 'C': 0, 'L': 0,
                  		'G': 0, 'I': 0, '.': 0
                  	};
                  
                  for (var i = 0; i < lines.length; i++) {
                  	var line = lines[i].match(/([A-z0-9 ]+): (.*)/);
                  
                  	if (line !== null) {
                  		output[line[1]] = isNaN(line[2]) ? line[2] : Number(line[2]);
                  	}
                  }
                  
                  output.ServerUptimeSeconds = output.ServerUptimeSeconds || output.Uptime;
                  output.ServerVersion = output.ServerVersion || output.Server;
                  
                  if (typeof output.Scoreboard === 'string') {
                  	for (var i = 0; i < output.Scoreboard.length; i++) {
                  		var char = output.Scoreboard[i];
                  
                  		workers[char]++;
                  	}
                  }
                  
                  output.Workers = {
                  	waiting: workers['_'], starting: workers['S'], reading: workers['R'],
                  	sending: workers['W'], keepalive: workers['K'], dnslookup: workers['D'],
                  	closing: workers['C'], logging: workers['L'], finishing: workers['G'],
                  	cleanup: workers['I'], slot: workers['.']
                  };
                  
                  return JSON.stringify(output);
                  
          tags:
            - tag: component
              value: raw
      discovery_rules:
        - uuid: 515cf6de9c5e416fa92d0e57edf67821
          name: 'Event MPM discovery'
          type: DEPENDENT
          key: apache.mpm.event.discovery
          description: |
            The discovery of additional metrics if the event Multi-Processing Module (MPM) is used.
            For more details see [Apache MPM event](https://httpd.apache.org/docs/current/mod/event.html).
          item_prototypes:
            - uuid: 70d1b07060934bb5aa5656dab7ae30b0
              name: 'Bytes per request'
              type: DEPENDENT
              key: 'apache.bytes[per_request{#SINGLETON}]'
              value_type: FLOAT
              units: B
              description: 'The average number of client requests per second.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.BytesPerReq
              master_item:
                key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
              tags:
                - tag: component
                  value: connection
            - uuid: c79d6ab68e3e402cb6dd77754373a57b
              name: 'Connections async closing'
              type: DEPENDENT
              key: 'apache.connections[async_closing{#SINGLETON}]'
              description: 'The number of asynchronous connections in closing state (applicable only to the event MPM).'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.ConnsAsyncClosing
              master_item:
                key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
              tags:
                - tag: component
                  value: connection
            - uuid: b1bf3bf3e0fa4055a6b9586ef3f00717
              name: 'Connections async keepalive'
              type: DEPENDENT
              key: 'apache.connections[async_keep_alive{#SINGLETON}]'
              description: 'The number of asynchronous connections in keepalive state (applicable only to the event MPM).'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.ConnsAsyncKeepAlive
              master_item:
                key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
              tags:
                - tag: component
                  value: connection
            - uuid: eed7e7950792461c89dd2ad7b4a093bc
              name: 'Connections async writing'
              type: DEPENDENT
              key: 'apache.connections[async_writing{#SINGLETON}]'
              description: 'The number of asynchronous connections in writing state (applicable only to the event MPM).'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.ConnsAsyncWriting
              master_item:
                key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
              tags:
                - tag: component
                  value: connection
            - uuid: 135cf6fa598b47fba0fa694835a810d9
              name: 'Connections total'
              type: DEPENDENT
              key: 'apache.connections[total{#SINGLETON}]'
              description: 'The number of total connections.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.ConnsTotal
              master_item:
                key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
              tags:
                - tag: component
                  value: connection
            - uuid: 86af6c0efd3045239fcb39df78a5a32e
              name: 'Number of async processes'
              type: DEPENDENT
              key: 'apache.process[num{#SINGLETON}]'
              description: 'The number of asynchronous processes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.Processes
              master_item:
                key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
              tags:
                - tag: component
                  value: system
          graph_prototypes:
            - uuid: df123216f5464f278e5b08f476216c4c
              name: 'Apache: Current async connections{#SINGLETON}'
              graph_items:
                - color: 199C0D
                  item:
                    host: 'Apache by Zabbix agent'
                    key: 'apache.connections[async_closing{#SINGLETON}]'
                - sortorder: '1'
                  color: F63100
                  item:
                    host: 'Apache by Zabbix agent'
                    key: 'apache.connections[async_keep_alive{#SINGLETON}]'
                - sortorder: '2'
                  color: 00611C
                  item:
                    host: 'Apache by Zabbix agent'
                    key: 'apache.connections[async_writing{#SINGLETON}]'
                - sortorder: '3'
                  drawtype: BOLD_LINE
                  color: F7941D
                  item:
                    host: 'Apache by Zabbix agent'
                    key: 'apache.connections[total{#SINGLETON}]'
            - uuid: 4466640b5a864c03afebf215407b5559
              name: 'Apache: Current async processes{#SINGLETON}'
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 199C0D
                  item:
                    host: 'Apache by Zabbix agent'
                    key: 'apache.process[num{#SINGLETON}]'
          master_item:
            key: 'web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"]'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  return JSON.stringify(JSON.parse(value).ServerMPM === 'event'
                  	? [{'{#SINGLETON}': ''}] : []);
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 3h
        - uuid: 9f4849c832d94ba08e12b9563aa8243c
          name: 'Apache process discovery'
          type: DEPENDENT
          key: apache.proc.discovery
          filter:
            evaltype: AND
            conditions:
              - macro: '{#APACHE.NAME}'
                value: '{$APACHE.PROCESS_NAME}'
          description: 'The discovery of the Apache process summary.'
          item_prototypes:
            - uuid: 0259e3dab07042b9b95d6939da9ff179
              name: 'Get process data'
              type: DEPENDENT
              key: 'apache.proc.get[{#APACHE.NAME}]'
              history: '0'
              value_type: TEXT
              description: 'The summary metrics aggregated by a process {#APACHE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@["name"]=="{#APACHE.NAME}")].first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: 'Failed to retrieve process {#APACHE.NAME} data'
              master_item:
                key: 'proc.get[{$APACHE.PROCESS.NAME.PARAMETER},,,summary]'
              tags:
                - tag: component
                  value: raw
            - uuid: 37e12493f8614c348941aea275399b70
              name: 'Number of running processes'
              type: DEPENDENT
              key: 'apache.proc.num[{#APACHE.NAME}]'
              description: 'The number of running processes {#APACHE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.processes
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'apache.proc.get[{#APACHE.NAME}]'
              tags:
                - tag: component
                  value: system
              trigger_prototypes:
                - uuid: e4dc22882fde44b7a2c78fb3cf5ea60d
                  expression: 'last(/Apache by Zabbix agent/apache.proc.num[{#APACHE.NAME}])=0'
                  name: 'Apache: Process is not running'
                  priority: HIGH
                  tags:
                    - tag: scope
                      value: availability
            - uuid: c0c38a13d3cf4790b2c17f5f21fbafdf
              name: 'Memory usage, %'
              type: DEPENDENT
              key: 'apache.proc.pmem[{#APACHE.NAME}]'
              value_type: FLOAT
              units: '%'
              description: 'The percentage of real memory used by a process {#APACHE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.pmem
                  error_handler: DISCARD_VALUE
              master_item:
                key: 'apache.proc.get[{#APACHE.NAME}]'
              tags:
                - tag: component
                  value: memory
            - uuid: c9907d5f24af432aa7c5851ce86c92fa
              name: 'Memory usage (rss)'
              type: DEPENDENT
              key: 'apache.proc.rss[{#APACHE.NAME}]'
              units: B
              description: 'The summary of resident set size memory used by a process {#APACHE.NAME} expressed in bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.rss
                  error_handler: DISCARD_VALUE
              master_item:
                key: 'apache.proc.get[{#APACHE.NAME}]'
              tags:
                - tag: component
                  value: memory
            - uuid: dadcbeddefc64cf9a7d951cb3f8da4fb
              name: 'Memory usage (vsize)'
              type: DEPENDENT
              key: 'apache.proc.vmem[{#APACHE.NAME}]'
              units: B
              description: 'The summary of virtual memory used by a process {#APACHE.NAME} expressed in bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.vsize
                  error_handler: DISCARD_VALUE
              master_item:
                key: 'apache.proc.get[{#APACHE.NAME}]'
              tags:
                - tag: component
                  value: memory
            - uuid: 021118cff3e4433b9ee8c1621b8e297a
              name: 'CPU utilization'
              key: 'proc.cpu.util[{#APACHE.NAME}]'
              value_type: FLOAT
              units: '%'
              description: 'The percentage of the CPU utilization by a process {#APACHE.NAME}.'
              tags:
                - tag: component
                  value: cpu
                - tag: software
                  value: apache
          trigger_prototypes:
            - uuid: 5133a3acafc04c749a4589db4eb391fe
              expression: 'nodata(/Apache by Zabbix agent/web.page.get["{$APACHE.STATUS.SCHEME}://{$APACHE.STATUS.HOST}:{$APACHE.STATUS.PORT}/{$APACHE.STATUS.PATH}"],30m)=1 and last(/Apache by Zabbix agent/apache.proc.num[{#APACHE.NAME}])>0'
              name: 'Apache: Failed to fetch status page'
              event_name: 'Apache: Failed to fetch status page (or no data for 30m)'
              priority: WARNING
              description: 'Zabbix has not received any data for items for the last 30 minutes.'
              manual_close: 'YES'
              dependencies:
                - name: 'Apache: Service is down'
                  expression: 'last(/Apache by Zabbix agent/net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"])=0 and last(/Apache by Zabbix agent/apache.proc.num[{#APACHE.NAME}])>0'
              tags:
                - tag: scope
                  value: availability
            - uuid: c620833391414892b2bdcfdd7b545bc2
              expression: 'last(/Apache by Zabbix agent/net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"])=0 and last(/Apache by Zabbix agent/apache.proc.num[{#APACHE.NAME}])>0'
              name: 'Apache: Service is down'
              priority: AVERAGE
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
            - uuid: 5f9d8e50fdcc44d7b257781a103cd285
              expression: 'min(/Apache by Zabbix agent/net.tcp.service.perf[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"],5m)>{$APACHE.RESPONSE_TIME.MAX.WARN} and last(/Apache by Zabbix agent/apache.proc.num[{#APACHE.NAME}])>0'
              name: 'Apache: Service response time is too high'
              event_name: 'Apache: Service response time is too high (over {$APACHE.RESPONSE_TIME.MAX.WARN}s for 5m)'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: 'Apache: Service is down'
                  expression: 'last(/Apache by Zabbix agent/net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"])=0 and last(/Apache by Zabbix agent/apache.proc.num[{#APACHE.NAME}])>0'
              tags:
                - tag: scope
                  value: performance
          graph_prototypes:
            - uuid: c5ccf6a728024564966751e5b5d98cbc
              name: 'Apache: Memory usage[{#APACHE.NAME}]'
              graph_items:
                - drawtype: BOLD_LINE
                  color: 199C0D
                  item:
                    host: 'Apache by Zabbix agent'
                    key: 'apache.proc.vmem[{#APACHE.NAME}]'
                - sortorder: '1'
                  drawtype: BOLD_LINE
                  color: F63100
                  item:
                    host: 'Apache by Zabbix agent'
                    key: 'apache.proc.rss[{#APACHE.NAME}]'
          master_item:
            key: 'proc.get[{$APACHE.PROCESS.NAME.PARAMETER},,,summary]'
          lld_macro_paths:
            - lld_macro: '{#APACHE.NAME}'
              path: $.name
      tags:
        - tag: class
          value: software
        - tag: subclass
          value: webserver
        - tag: target
          value: apache
      macros:
        - macro: '{$APACHE.PROCESS.NAME.PARAMETER}'
          description: 'The process name of the Apache web server used in the item key `proc.get`. It could be specified if the correct process name is known.'
          config:
            type: TEXT
            priority: '7'
            section_name: Other
            label: 'Apache process name'
            description: 'Process name of the Apache web server Used in the item key `proc.get`.'
        - macro: '{$APACHE.PROCESS_NAME}'
          value: (httpd|apache2)
          description: 'The process name filter for the Apache process discovery.'
          config:
            type: TEXT
            priority: '6'
            section_name: Other
            label: 'Apache process name LLD filter'
            description: 'Process name filter for the Apache process discovery.'
        - macro: '{$APACHE.RESPONSE_TIME.MAX.WARN}'
          value: '10'
          description: 'The maximum Apache response time expressed in seconds for a trigger expression.'
          config:
            type: TEXT
            priority: '5'
            section_name: Other
            label: 'Maximum Apache response time'
            description: 'Maximum Apache response time expressed in seconds for a trigger expression. No less than 0.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$APACHE.STATUS.HOST}'
          value: 127.0.0.1
          description: 'The hostname or IP address of the Apache status page.'
          config:
            type: TEXT
            priority: '1'
            label: 'Apache status host'
            description: 'Hostname or IP address of the Apache status page host.'
            required: 'YES'
        - macro: '{$APACHE.STATUS.PATH}'
          value: 'server-status?auto'
          description: 'The URL path of the Apache status page.'
          config:
            type: TEXT
            priority: '3'
            label: 'Apache status page path'
            description: 'URL path of the Apache status page.'
            required: 'YES'
        - macro: '{$APACHE.STATUS.PORT}'
          value: '80'
          description: 'The port of the Apache status page.'
          config:
            type: TEXT
            priority: '2'
            label: 'Apache status page port'
            description: 'In the range from 1 to 65535 inclusive.'
            required: 'YES'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$APACHE.STATUS.SCHEME}'
          value: http
          description: 'The request scheme, which may be either HTTP or HTTPS.'
          config:
            type: LIST
            priority: '4'
            label: 'Request scheme'
            description: 'Request scheme, which may be either HTTP or HTTPS.'
            options:
              - value: http
                text: HTTP
              - value: https
                text: HTTPS
      dashboards:
        - uuid: 36751ac3b4b0401e9b6845b1f433e2ea
          name: 'Apache performance'
          pages:
            - name: General
              widgets:
                - type: graph
                  width: '72'
                  height: '7'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'Apache by Zabbix agent'
                        name: 'Apache: Worker states'
                    - type: STRING
                      name: reference
                      value: AAAAA
                - type: graph
                  'y': '7'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'Apache by Zabbix agent'
                        name: 'Apache: Requests per second'
                    - type: STRING
                      name: reference
                      value: AAAAB
                - type: graphprototype
                  'y': '12'
                  width: '36'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Apache by Zabbix agent'
                        name: 'Apache: Current async connections{#SINGLETON}'
                    - type: STRING
                      name: reference
                      value: AAAAD
                - type: graph
                  x: '36'
                  'y': '7'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'Apache by Zabbix agent'
                        name: 'Apache: Workers total'
                    - type: STRING
                      name: reference
                      value: AAAAC
                - type: graphprototype
                  x: '36'
                  'y': '12'
                  width: '36'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Apache by Zabbix agent'
                        name: 'Apache: Current async processes{#SINGLETON}'
                    - type: STRING
                      name: reference
                      value: AAAAE
      valuemaps:
        - uuid: 4c0c0e7846ac4139be9d38290b63fd63
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
  graphs:
    - uuid: a2822dc926ba4d75af337546f8c19761
      name: 'Apache: Requests per second'
      graph_items:
        - drawtype: GRADIENT_LINE
          color: 199C0D
          item:
            host: 'Apache by Zabbix agent'
            key: apache.requests.rate
    - uuid: 869c2d17d0cf4af8a018c0d82e180f6f
      name: 'Apache: Worker states'
      graph_items:
        - color: 199C0D
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.dnslookup
        - sortorder: '1'
          color: F63100
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.cleanup
        - sortorder: '2'
          color: 00611C
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.logging
        - sortorder: '3'
          color: F7941D
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.reading
        - sortorder: '4'
          color: FC6EA3
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.sending
        - sortorder: '5'
          color: 6C59DC
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.starting
        - sortorder: '6'
          color: C7A72D
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.closing
        - sortorder: '7'
          color: BA2A5D
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.finishing
        - sortorder: '8'
          color: F230E0
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.keepalive
        - sortorder: '9'
          color: 5CCD18
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.slot
        - sortorder: '10'
          color: BB2A02
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers.waiting
    - uuid: 74f2761fdde54d07b6d325632501e025
      name: 'Apache: Workers total'
      type: STACKED
      graph_items:
        - color: 199C0D
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers_total.busy
        - sortorder: '1'
          color: F63100
          item:
            host: 'Apache by Zabbix agent'
            key: apache.workers_total.idle
